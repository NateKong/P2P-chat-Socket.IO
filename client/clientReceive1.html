<!doctype html>
<html>
  <head>
    <title>P2P</title>
	<style>
	  body{ margin:0; padding:0; }
	  #ip{ margin: 0 auto; text-align: center; }
	  input{ width: 200px;}
	  
	  #chatbox { margin: auto 5%; }
	  #chat { float: left; width: 90%; overflow: auto;  }
	  #sendMessage { border: 2px solid #000; padding: 3px; position: fixed; bottom: 0; width: 90%; }
      #sendMessage input {  height: 3em; margin: 0; padding: 0; width: 89.25%;  }
      #sendMessage button { float:right; width: 9.25%; height: 3em; background: #0080FF; border: none; }
    </style>
  </head>
  <body>
	<!--User IP and port-->
	<form id="ip" action="">
	  <h2>Please enter IP:Port</h2>
	  <input id="info" autocomplete="off" />
	  <button>Send</button>
	</form>
	<!--Chat box for one user-->	
	<div id="chatbox">
		<div id="chat">CHAT</div>
		
		<form id="sendMessage" action="">
		  <input id="message" autocomplete="off" /><button>Send</button>
		</form>
	</div>
		
		
		
	<script src="/socket.io/socket.io.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
	<script>
	  var app = require('express')();
	  var http = require('http').crateServer(app);
	  var p2p = require('socket.io')(http);

	  $(document).ready(function(){
		$('#chatbox').hide();
		
	  });
	  
	  //get port info
	  $('#ip').submit(function(){
		listen( $('#info').val() );
		$('#info').val('');
		$('#ip').hide();
		$('#chatbox').show();
		return false;
	  });
	  
	  function listen(myport){
	    /*LISTEN ON PORT*/
		http.listen(myport, function(){
		  console.log('listening on Port:' + myport);
		});
	  }
	  
	  /*MAKE CONNECTION*/
	  p2p.on('connection', function(socket){
	    //get a message
		  socket.on('chat message', function(msg){
			$('#chat').append($('<li>').text(msg));
		  });

	  });
	  
	  
	  
	  
	/*  
	//send message
	$('#sendMessage').submit(function(){
	  var msg = 'A: ' + $('#message').val();
	  p2p.emit('chat message', msg);
	  $('#chat').append($('<li>').text(msg));
	  $('#message').val('');
	  return false;
	});*/
	
	
	
	</script>
  </body>
</html>